(this.webpackJsonpsecret_chatroom=this.webpackJsonpsecret_chatroom||[]).push([[0],{18:function(e,t,n){e.exports=n(43)},23:function(e,t,n){},43:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(15),c=n.n(o),s=(n(23),n(1)),u=n.n(s),l=n(2),i=n(4),m=function(e){var t=e.handleSubmit,n=e.handleUsernameChange,a=e.handlePasswordChange,o=e.username,c=e.password,s=e.status;return r.a.createElement("div",{className:"fieldInfo"},r.a.createElement("form",{onSubmit:t},r.a.createElement("div",{className:"fieldInfo"},"Username"),r.a.createElement("input",{id:"username",value:o,onChange:n}),r.a.createElement("div",{className:"fieldInfo"},"Password"),r.a.createElement("input",{id:"password",type:"password",value:c,onChange:a}),r.a.createElement("br",null),r.a.createElement("button",{className:"buttonLogin",type:"submit",id:"login-button"},s?"Log In":"Sign Up")))},p=function(e){var t=e.handleCreateNameChange,n=e.handleCreatePassChange,a=e.handleJoinNameChange,o=e.handleJoinPassChange,c=e.createName,s=e.createPass,u=e.joinName,l=e.joinPass,i=e.handleCreate,m=e.handleDelete,p=e.handleJoin,d=e.handleLeave,f=e.handleEnter,h=e.handleLogout,v=e.user,g=e.rooms;return r.a.createElement("div",{className:"lobby"},r.a.createElement("form",{className:"form-inline",onSubmit:i},r.a.createElement("input",{id:"roomName",placeholder:"Enter room name",value:c,onChange:t}),r.a.createElement("input",{type:"password",id:"roomPass",placeholder:"Enter room password",value:s,onChange:n}),r.a.createElement("button",{type:"submit"},"Create Room")),r.a.createElement("form",{className:"form-inline",onSubmit:p},r.a.createElement("input",{id:"joinId",placeholder:"Enter room ID",value:u,onChange:a}),r.a.createElement("input",{type:"password",id:"joinPass",placeholder:"Enter room password",value:l,onChange:o}),r.a.createElement("button",{type:"submit"},"Join Room")),r.a.createElement("h2",null,"Your Rooms"),function(e){return r.a.createElement("nav",null,r.a.createElement("ul",null,e.map((function(e){return r.a.createElement("li",{className:"roomSelection",key:e.id},r.a.createElement("div",{className:"rooms"},r.a.createElement("em",null,r.a.createElement("b",null,e.roomName)),r.a.createElement("hr",null),r.a.createElement("button",{className:"roomButtons",value:e.id,onClick:f},"Enter Room"),r.a.createElement("button",{className:"roomButtons",value:e.id,onClick:d},"Leave Room"),e.roomCreator===v.user.username&&r.a.createElement("button",{className:"roomButtons",value:e.id,onClick:m},"Delete Room"),r.a.createElement("button",{className:"roomButtons",value:e.id,onClick:function(e){return navigator.clipboard.writeText(e.target.value)}},"Invite Code")))}))))}(g),r.a.createElement("button",{id:"logout",className:"roomButtons",onClick:h},"Log Out"))},d=n(5),f=n.n(d),h={login:function(){var e=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.post("/login",t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},v={signup:function(){var e=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.post("/signup",t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},g=null,b=function(){var e=Object(l.a)(u.a.mark((function e(t){var n,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={headers:{Authorization:g}},e.next=3,f.a.post("/room",t,n);case 3:return a=e.sent,e.abrupt("return",a.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={headers:{Authorization:g}},e.next=3,f.a.patch("".concat("/room","/leave/").concat(t),null,n);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),w=function(){var e=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={headers:{Authorization:g}},e.next=3,f.a.delete("".concat("/room","/").concat(t),n);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),j=function(){var e=Object(l.a)(u.a.mark((function e(t,n){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={headers:{Authorization:g}},e.next=3,f.a.patch("".concat("/room","/join/").concat(t),{password:n},a);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),x=function(){var e=Object(l.a)(u.a.mark((function e(t){var n,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={headers:{Authorization:g}},e.next=3,f.a.get("".concat("/room","/").concat(t),n);case 3:return a=e.sent,e.abrupt("return",a.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),k={setToken:function(e){g="bearer ".concat(e)},getRooms:function(){var e={headers:{Authorization:g}};return f.a.get("/room",e).then((function(e){return e.data}))},createRoom:b,leaveRoom:E,joinRoom:j,deleteRoom:w,enterRoom:x,getRoom:x,sendMessage:function(){var e=Object(l.a)(u.a.mark((function e(t,n){var a,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={headers:{Authorization:g}},e.next=3,f.a.post("".concat("/room","/").concat(t,"/message"),n,a);case 3:return r=e.sent,e.abrupt("return",r.data);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},O=function(e){var t=e.message;return null===t?null:r.a.createElement("div",{className:"error"},t)},N=n(16),C=n.n(N),y=n(17),S=function(e){var t=e.handleMessageChange,n=e.exitRoom,a=e.sendMessage,o=e.messageContent,c=e.room;return r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("h2",{className:"roomHeader"},"Welcome to ",c.roomName),r.a.createElement("button",{className:"exitRoomButton",onClick:n},"Exit Room"),r.a.createElement("ol",{className:"messages"},c.messages.map((function(e){return r.a.createElement("li",{className:"message",key:e.id},r.a.createElement("b",{className:"messageUser"},e.user),r.a.createElement("small",null," - ",C()(e.date).fromNow()),r.a.createElement("ol",null,r.a.createElement("li",null,e.content)))})))),r.a.createElement("div",null,r.a.createElement("form",{id:"messageForm",className:"form-inline",onSubmit:a},r.a.createElement(y.a,{className:"messageField",spellCheck:"true",value:o,form:"messageForm",onChange:t}),r.a.createElement("button",{id:"sendMessageButton",type:"submit"},"Send"))))};var R=function(){var e=Object(a.useState)(""),t=Object(i.a)(e,2),n=t[0],o=t[1],c=Object(a.useState)(""),s=Object(i.a)(c,2),d=s[0],f=s[1],g=Object(a.useState)(null),b=Object(i.a)(g,2),E=b[0],w=b[1],j=Object(a.useState)([]),x=Object(i.a)(j,2),N=x[0],C=x[1],y=Object(a.useState)(!0),R=Object(i.a)(y,2),I=R[0],T=R[1],P=Object(a.useState)(""),J=Object(i.a)(P,2),L=J[0],D=J[1],U=Object(a.useState)(""),A=Object(i.a)(U,2),B=A[0],z=A[1],M=Object(a.useState)(""),F=Object(i.a)(M,2),H=F[0],q=F[1],_=Object(a.useState)(""),W=Object(i.a)(_,2),Y=W[0],G=W[1],K=Object(a.useState)(null),Q=Object(i.a)(K,2),V=Q[0],X=Q[1],Z=Object(a.useState)(""),$=Object(i.a)(Z,2),ee=$[0],te=$[1],ne=Object(a.useState)(null),ae=Object(i.a)(ne,2),re=ae[0],oe=ae[1],ce=window.localStorage.getItem("loggedInUser");Object(a.useEffect)((function(){var e=ce;if(e){var t=JSON.parse(e);w(t),k.setToken(t.token)}}),[ce]),Object(a.useEffect)((function(){k.getRooms().then((function(e){C(e)})).catch((function(e){return console.log("waiting for user login")}))}),[N.length,ce]),Object(a.useEffect)((function(){var e=setInterval((function(){null!==V&&k.getRoom(V.id).then((function(e){X(e)})).catch((function(e){return console.log("waiting for user to enter a room")}))}),1e3);return function(){return clearInterval(e)}}),[V]);var se=function(){var e=Object(l.a)(u.a.mark((function e(t){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,e.next=4,h.login({username:n,password:d});case 4:a=e.sent,window.localStorage.setItem("loggedInUser",JSON.stringify(a)),k.setToken(a.token),w(a),o(""),f(""),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(1),oe("wrong credentials"),setTimeout((function(){oe(null)}),5e3);case 16:case"end":return e.stop()}}),e,null,[[1,12]])})));return function(t){return e.apply(this,arguments)}}(),ue=function(){var e=Object(l.a)(u.a.mark((function e(t){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),e.prev=1,(a=new Error).response={data:{error:"password too short: at least 6 characters required"}},!(d.trim().length<6)){e.next=6;break}throw a;case 6:return e.next=8,v.signup({username:n.trim(),password:d.trim()});case 8:o(""),f(""),T(!I),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),e.t0.response.data.error.includes("User validation failed")?oe("username either too short or already taken"):oe(e.t0.response.data.error),setTimeout((function(){oe(null)}),5e3);case 17:case"end":return e.stop()}}),e,null,[[1,13]])})));return function(t){return e.apply(this,arguments)}}(),le=function(){var e=Object(l.a)(u.a.mark((function e(t){var n,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),e.prev=1,(n=new Error).response={data:{error:"room password too short: at least 6 characters required"}},!(B.trim().length<6)){e.next=6;break}throw n;case 6:return e.next=8,k.createRoom({roomName:L.trim(),roomPass:B.trim()});case 8:a=e.sent,C(N.concat(a)),D(""),z(""),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(1),oe(e.t0.response.data.error),setTimeout((function(){oe(null)}),5e3);case 18:case"end":return e.stop()}}),e,null,[[1,14]])})));return function(t){return e.apply(this,arguments)}}(),ie=function(){var e=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.target.value,e.next=4,k.leaveRoom(n);case 4:C(N.filter((function(e){return e.id===n}))),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),oe(e.t0.response.data.error),setTimeout((function(){oe(null)}),5e3);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),me=function(){var e=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.target.value,e.next=4,k.deleteRoom(n);case 4:C(N.filter((function(e){return e.id===n}))),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),oe(e.t0.response.data.error),setTimeout((function(){oe(null)}),5e3);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),pe=function(){var e=Object(l.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,e.next=4,k.joinRoom(H,Y);case 4:C(N.concat(H)),q(""),G(""),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),oe(e.t0.response.data.error),setTimeout((function(){oe(null)}),5e3);case 13:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),de=function(){var e=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.enterRoom(t.target.value);case 3:n=e.sent,X(n),window.scrollTo(0,document.body.scrollHeight),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),oe(e.t0.response),setTimeout((function(){oe(null)}),5e3);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}(),fe=function(){var e=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.preventDefault(),e.next=4,k.sendMessage(V.id,{content:ee});case 4:n=e.sent,X(n),te(""),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),oe(e.t0.response.data.error),setTimeout((function(){oe(null)}),5e3);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),he=function(){T(!I),o(""),f("")},ve=function(e){return e?se:ue};return r.a.createElement("div",null,r.a.createElement("h1",{className:"header"},"Secret Chat"),r.a.createElement(O,{message:re}),null===V?null===E?r.a.createElement("div",null,!0===I?r.a.createElement("p",{className:"status"},"Logging in"):r.a.createElement("p",{className:"status"}," Signing up"),r.a.createElement(m,{handleSubmit:ve(I),handleUsernameChange:function(e){return o(e.target.value)},handlePasswordChange:function(e){return f(e.target.value)},status:I,username:n,password:d}),!0===I?r.a.createElement("button",{className:"buttonLogin",onClick:he},"Need to signup instead?"):r.a.createElement("button",{className:"buttonLogin",onClick:he},"Already have an account?")):r.a.createElement(p,{handleCreateNameChange:function(e){return D(e.target.value)},handleCreatePassChange:function(e){return z(e.target.value)},handleJoinNameChange:function(e){return q(e.target.value)},handleJoinPassChange:function(e){return G(e.target.value)},createName:L,createPass:B,joinName:H,joinPass:Y,handleCreate:le,handleDelete:me,handleLeave:ie,handleJoin:pe,handleEnter:de,handleLogout:function(e){window.localStorage.removeItem("loggedInUser"),k.setToken(null),X(null),w(null)},user:E,rooms:N}):r.a.createElement(S,{room:V,exitRoom:function(){return X(null)},messageContent:ee,sendMessage:fe,handleMessageChange:function(e){te(e.target.value),window.scrollTo(0,document.body.scrollHeight)}}))};c.a.render(r.a.createElement(R,null),document.getElementById("root"))}},[[18,1,2]]]);
//# sourceMappingURL=main.94959a30.chunk.js.map